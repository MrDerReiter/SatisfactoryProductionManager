<Window x:Class="SatisfactoryProductionManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SatisfactoryProductionManager"
        mc:Ignorable="d"
        Title="Менеджер производства"
        Height="600"
        Width="815"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStyle="None"
        MinHeight="450"
        MinWidth="815"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <ResourceDictionary>
            <BooleanToVisibilityConverter x:Key="BVConverter" />

            <!--Стили-->
            <Style x:Key="TopPanelBorder"
                   TargetType="Border"
                   BasedOn="{StaticResource WindowBorder}">

                <Setter Property="MinHeight"
                        Value="60" />
                <Setter Property="CornerRadius"
                        Value="10,10,0,0" />
                <Setter Property="BorderThickness"
                        Value="1" />
            </Style>
            <Style x:Key="LeftPanelBorder"
                   TargetType="Border"
                   BasedOn="{StaticResource TopPanelBorder}">

                <Setter Property="Width"
                        Value="80" />
                <Setter Property="CornerRadius"
                        Value="0,0,0,10" />
            </Style>
            <Style x:Key="MainPanelBorder"
                   TargetType="Border"
                   BasedOn="{StaticResource TopPanelBorder}">

                <Setter Property="CornerRadius"
                        Value="0,0,10,0" />
            </Style>

            <Style x:Key="AddLineButton"
                   TargetType="Button">

                <Setter Property="Background"
                        Value="DarkGray" />
                <Setter Property="BorderThickness"
                        Value="0" />
                <Setter Property="Width"
                        Value="40" />
                <Setter Property="Height"
                        Value="40" />
                <Setter Property="Margin"
                        Value="10" />
            </Style>
            <Style x:Key="ImageButtonBase"
                   TargetType="Button">

                <Setter Property="Background"
                        Value="DarkGray" />
            </Style>
            <Style x:Key="RequestButtonStyle"
                   TargetType="Button">

                <Setter Property="Background"
                        Value="LightGreen" />
                <Setter Property="BorderThickness"
                        Value="0" />
            </Style>
            <Style x:Key="ToolkitPanelButton"
                   TargetType="Button">

                <Setter Property="Background"
                        Value="Gray" />
                <Setter Property="Width"
                        Value="30" />
                <Setter Property="Height"
                        Value="30" />
            </Style>
            <Style x:Key="TopPanelButtonStyle"
                   TargetType="Button"
                   BasedOn="{StaticResource ImageButtonBase}">

                <Setter Property="Width"
                        Value="40" />
                <Setter Property="Height"
                        Value="40" />
            </Style>
            <Style x:Key="LeftPanelButtonStyle"
                   TargetType="Button"
                   BasedOn="{StaticResource ImageButtonBase}">

                <Setter Property="Width"
                        Value="45" />
                <Setter Property="Height"
                        Value="45" />
                <Setter Property="Margin"
                        Value="0,0,0,3" />
            </Style>
            <Style x:Key="ProductionUnitToolkitButton"
                   TargetType="Button">

                <Setter Property="Background"
                        Value="LightGray" />
            </Style>
            <Style x:Key="UseSomersloopButton"
                   TargetType="Button">

                <Setter Property="Background"
                        Value="GhostWhite" />
                <Setter Property="HorizontalAlignment"
                        Value="Stretch" />
                <Setter Property="Height"
                        Value="20" />

                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsSomersloopUsed}"
                                 Value="True">

                        <Setter Property="Background"
                                Value="MediumPurple" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="TextBase"
                   TargetType="TextBlock">

                <Setter Property="Foreground"
                        Value="GhostWhite" />
                <Setter Property="TextAlignment"
                        Value="Center" />
            </Style>
            <Style x:Key="OvercklockTextBox"
                   TargetType="TextBox">

                <Setter Property="Background"
                        Value="GhostWhite" />
                <Setter Property="Foreground"
                        Value="Black" />
                <Setter Property="Height"
                        Value="20" />
                <Setter Property="HorizontalAlignment"
                        Value="Stretch" />
                <Setter Property="FontSize"
                        Value="10" />
                <Setter Property="TextAlignment"
                        Value="Center" />
                <Setter Property="VerticalContentAlignment"
                        Value="Center" />
                <Setter Property="TextOptions.TextRenderingMode"
                        Value="Aliased" />
            </Style>

            <!--Шаблоны-->
            <DataTemplate x:Key="TopPanelButtonTemplate">
                <Button Style="{StaticResource TopPanelButtonStyle}"
                        Command="{Binding SelectObjectCommand}">

                    <Image Source="{Binding Image}"
                           RenderOptions.BitmapScalingMode="HighQuality" />
                </Button>
            </DataTemplate>
            <DataTemplate x:Key="LeftPanelButtonTemplate">
                <Button Style="{StaticResource LeftPanelButtonStyle}"
                        Command="{Binding SelectObjectCommand}">

                    <Image Source="{Binding Image}"
                           RenderOptions.BitmapScalingMode="HighQuality" />
                </Button>
            </DataTemplate>
            <DataTemplate x:Key="RequestButtonTemplate">
                <StackPanel Width="50"
                            Margin="1,0,0,0">

                    <Button Style="{StaticResource RequestButtonStyle}"
                            ToolTip="Развернуть производственный цех"
                            Command="{Binding SelectObjectCommand}">

                        <Image Source="{Binding Image}"
                               RenderOptions.BitmapScalingMode="HighQuality" />
                    </Button>

                    <TextBlock Background="Green"
                               Foreground="GhostWhite"
                               TextAlignment="Center"
                               Text="{Binding Count}" />

                </StackPanel>
            </DataTemplate>
            <DataTemplate x:Key="ProductionLineInputButton">
                <StackPanel Width="35">

                    <Button ToolTip="Развернуть производственный блок"
                            Background="LightGreen"
                            Command="{Binding SelectObjectCommand}">

                        <Image Source="{Binding Image}"
                               RenderOptions.BitmapScalingMode="HighQuality" />
                    </Button>

                    <TextBlock Background="Green"
                               Foreground="GhostWhite"
                               TextAlignment="Center"
                               Text="{Binding Count}" />
                </StackPanel>
            </DataTemplate>
            <DataTemplate x:Key="ProductionLineOutputIcon">
                <StackPanel Width="35"
                            Background="LightBlue">

                    <Image Source="{Binding Image}"
                           RenderOptions.BitmapScalingMode="HighQuality" />

                    <TextBlock Background="CadetBlue"
                               Foreground="GhostWhite"
                               TextAlignment="Center"
                               Text="{Binding Count}" />
                </StackPanel>
            </DataTemplate>
            <DataTemplate x:Key="ProductionBlockByproductButton">
                <StackPanel Width="50"
                            Background="IndianRed">

                    <Image Source="{Binding Image}"
                           RenderOptions.BitmapScalingMode="HighQuality" />

                    <TextBlock Background="Crimson"
                               Foreground="GhostWhite"
                               TextAlignment="Center"
                               Text="{Binding Count}" />
                </StackPanel>
            </DataTemplate>
            <DataTemplate x:Key="ProductionUnitOutputIcon">
                <StackPanel Width="70"
                            Background="LightBlue">

                    <Image ToolTip="{Binding Tooltip}"
                           Source="{Binding Image}"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           Margin="5" />

                    <TextBlock Background="CadetBlue"
                               Foreground="GhostWhite"
                               TextAlignment="Center"
                               Text="{Binding Count}" />
                </StackPanel>
            </DataTemplate>
            <DataTemplate x:Key="ProductionUnitInputIcon">
                <StackPanel Width="70"
                            Background="LightGreen">

                    <Image ToolTip="{Binding Tooltip}"
                           Source="{Binding Image}"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           Margin="5" />

                    <TextBlock Background="Green"
                               Foreground="GhostWhite"
                               TextAlignment="Center"
                               Text="{Binding Count}" />
                </StackPanel>
            </DataTemplate>
            <DataTemplate x:Key="ProductionUnitPanel">
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Left"
                            Margin="3">

                    <StackPanel Width="32"
                                Margin="3,3,0,3">

                        <Button Style="{StaticResource ProductionUnitToolkitButton}"
                                Command="{Binding RemoveProductionUnitCommand}"
                                ToolTip="Удалить цех">

                            <Image Source="../Assets/DeleteItem.png"
                                   RenderOptions.BitmapScalingMode="HighQuality" />
                        </Button>

                        <Button Style="{StaticResource ProductionUnitToolkitButton}"
                                Command="{Binding ConvertUnitToBlockCommand}"
                                ToolTip="Преобразовать цех в производственный блок">

                            <Image Source="../Assets/AddItem.png"
                                   RenderOptions.BitmapScalingMode="HighQuality" />
                        </Button>

                        <TextBox Style="{StaticResource OvercklockTextBox}"
                                 Text="{Binding Path=OverclockView, Mode=TwoWay}"
                                 MouseWheel="OnOverclockMouseWheel"
                                 ToolTip="Разгон" />

                        <Button Style="{StaticResource UseSomersloopButton}"
                                Command="{Binding SetSomersloopCommand}"
                                ToolTip="Использовать петлевик">

                            <Image Source="../Assets/Resources/Somersloop.png"
                                   RenderOptions.BitmapScalingMode="HighQuality" />
                        </Button>
                    </StackPanel>

                    <StackPanel Width="70"
                                Margin="3">

                        <TextBlock Style="{StaticResource TextBase}"
                                   Text="Станки" />

                        <StackPanel Background="PaleGoldenrod">

                            <Image ToolTip="{Binding MachineName}"
                                   Source="{Binding MachineView}"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   Margin="5" />

                            <TextBox Text="{Binding Path=MachineCountView, Mode=TwoWay}"
                                     Background="Orange"
                                     BorderThickness="0"
                                     TextAlignment="Center" />
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Margin="3">

                        <TextBlock Style="{StaticResource TextBase}"
                                   Text="Продукция" />

                        <ItemsControl ItemsSource="{Binding Products}"
                                      ItemTemplate="{StaticResource ProductionUnitOutputIcon}">

                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>

                    <StackPanel Margin="3">

                        <TextBlock Style="{StaticResource TextBase}"
                                   Text="Компоненты" />

                        <ItemsControl ItemsSource="{Binding Requests}"
                                      ItemTemplate="{StaticResource ProductionUnitInputIcon}">

                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>

                    <StackPanel Visibility="{Binding Path=IsOverclocked, Converter={StaticResource BVConverter}}"
                                Margin="3">

                        <TextBlock Style="{StaticResource TextBase}"
                                   Text="Энергоячейки" />

                        <StackPanel Width="70"
                                    Background="LightSalmon">

                            <Image Source="../Assets/Resources/SyntheticPowerShard.png"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   ToolTip="Энергоячейка"
                                   Margin="5" />

                            <TextBlock Background="Chocolate"
                                       Foreground="GhostWhite"
                                       TextAlignment="Center"
                                       Text="{Binding PowerShardCountView}" />
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Visibility="{Binding Path=IsSomersloopUsed, Converter={StaticResource BVConverter}}"
                                Margin="3">

                        <TextBlock Style="{StaticResource TextBase}"
                                   Text="Петлевики" />

                        <StackPanel Background="MediumPurple"
                                    Width="70">

                            <Image Source="../Assets/Resources/Somersloop.png"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   ToolTip="Петлевик"
                                   Margin="5" />

                            <TextBlock Background="Purple"
                                       Foreground="GhostWhite"
                                       TextAlignment="Center"
                                       Text="{Binding SomersloopCountView}" />
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </DataTemplate>
        </ResourceDictionary>
    </Window.Resources>
    <Window.DataContext>
        <local:MainWindowVM />
    </Window.DataContext>

    <Border Style="{StaticResource WindowBorder}">

        <DockPanel>
            <Border Style="{StaticResource TopPanelBorder}"
                    DockPanel.Dock="Top"
                    MouseMove="OnHeaderDragMove">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Button Style="{StaticResource AddLineButton}"
                            Grid.Column="0"
                            ToolTip="Добавить производственную линию"
                            Command="{Binding AddProductionLineCommand}">

                        <Image Source="../Assets/AddLine.png" />
                    </Button>

                    <ItemsControl ItemsSource="{Binding ProductionLineButtons}"
                                  ItemTemplate="{StaticResource TopPanelButtonTemplate}"
                                  Grid.Column="1"
                                  Margin="5">

                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>

                    <StackPanel Orientation="Horizontal"
                                Margin="10"
                                Grid.Column="2">

                        <Button Background="Gray"
                                BorderThickness="0"
                                ToolTip="Закрыть окно"
                                Width="40"
                                Height="40"
                                Click="OnUserPressedClose">

                            <Image Source="../Assets/Close.png" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <Border Style="{StaticResource LeftPanelBorder}"
                    DockPanel.Dock="Left">

                <ScrollViewer VerticalScrollBarVisibility="Auto">

                    <ItemsControl ItemsSource="{Binding ProductionBlockButtons}"
                                  ItemTemplate="{StaticResource LeftPanelButtonTemplate}"
                                  Margin="5" />
                </ScrollViewer>

            </Border>

            <Border Style="{StaticResource MainPanelBorder}">

                <DockPanel>
                    <Grid DockPanel.Dock="Top">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Border Style="{StaticResource SubpanelBorder}"
                                VerticalAlignment="Top"
                                Grid.Column="0">

                            <StackPanel Orientation="Horizontal">

                                <Button Style="{StaticResource ToolkitPanelButton}"
                                        Command="{Binding AddProductionBlockCommand}"
                                        ToolTip="Добавить производственный блок в текущую линию">

                                    <Image Source="../Assets/AddItem.png"
                                           RenderOptions.BitmapScalingMode="HighQuality" />
                                </Button>

                                <Button Style="{StaticResource ToolkitPanelButton}"
                                        Command="{Binding RemoveActiveBlockCommand}"
                                        ToolTip="Удалить производственный блок (если блок основной, вместе с ним будет удалена вся производственная линия)">

                                    <Image Source="../Assets/DeleteItem.png"
                                           Margin="2"
                                           RenderOptions.BitmapScalingMode="HighQuality" />
                                </Button>
                            </StackPanel>
                        </Border>

                        <Border Style="{StaticResource SubpanelBorder}"
                                VerticalAlignment="Top"
                                Grid.Column="1">

                            <StackPanel Orientation="Horizontal">

                                <Button Style="{StaticResource ToolkitPanelButton}"
                                        Command="{Binding MoveActiveLineLeftCommand}"
                                        ToolTip="Переместить текущую линию левее">

                                    <Image Source="../Assets/MoveLineLeft.png"
                                           RenderOptions.BitmapScalingMode="HighQuality" />
                                </Button>

                                <Button Style="{StaticResource ToolkitPanelButton}"
                                        Command="{Binding MoveActiveLineRightCommand}"
                                        Margin="3,0,0,0"
                                        ToolTip="Переместить текущую линию правее">

                                    <Image Source="../Assets/MoveLineRight.png"
                                           RenderOptions.BitmapScalingMode="HighQuality">
                                    </Image>
                                </Button>
                            </StackPanel>
                        </Border>

                        <Border Style="{StaticResource SubpanelBorder}"
                                Visibility="{Binding Path=IsLineSelected, Converter={StaticResource BVConverter}}"
                                Grid.Column="2">

                            <StackPanel DataContext="{Binding ActiveLineIO}"
                                        Orientation="Horizontal">

                                <TextBlock Style="{StaticResource TextBase}"
                                           Margin="3,0"
                                           Text="Выход" />

                                <ItemsControl MaxWidth="300"
                                              Margin="10,0,0,0"
                                              ItemsSource="{Binding OutputButtons}"
                                              ItemTemplate="{StaticResource ProductionLineOutputIcon}">

                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>

                                <TextBlock Style="{StaticResource TextBase}"
                                           Margin="3,0"
                                           Text="Вход" />

                                <ItemsControl Margin="10,0,0,0"
                                              ItemsSource="{Binding InputButtons}"
                                              ItemTemplate="{StaticResource ProductionLineInputButton}">

                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <Border Style="{StaticResource SubpanelBorder}">

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Row="0"
                                        Grid.Column="1"
                                        VerticalAlignment="Top"
                                        Visibility="{Binding Path=IsBlockSelected, Converter={StaticResource BVConverter}}">

                                <TextBlock Style="{StaticResource TextBase}"
                                           TextAlignment="Left"
                                           Margin="0,0,0,5"
                                           Text="Выход" />

                                <WrapPanel DataContext="{Binding ProductionBlockWorkspace}">

                                    <StackPanel Width="50"
                                                DataContext="{Binding ProductionRequestButton}">

                                        <Button Background="LightGreen"
                                                BorderThickness="0"
                                                ToolTip="Обновить запрос"
                                                Command="{Binding SelectObjectCommand}">

                                            <Image Source="{Binding Image}"
                                                   RenderOptions.BitmapScalingMode="HighQuality" />
                                        </Button>

                                        <TextBox Background="Green"
                                                 Foreground="GhostWhite"
                                                 TextAlignment="Center"
                                                 Text="{Binding Path=RequestValue, Mode=TwoWay}" />
                                    </StackPanel>

                                    <ItemsControl ItemsSource="{Binding ByproductButtons}"
                                                  ItemTemplate="{StaticResource ProductionBlockByproductButton}"
                                                  Margin="10,0,0,0">

                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>
                                </WrapPanel>
                            </StackPanel>

                            <StackPanel Grid.Row="0"
                                        Grid.Column="2"
                                        Margin="20,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Visibility="{Binding Path=IsBlockSelected, Converter={StaticResource BVConverter}}">

                                <TextBlock Style="{StaticResource TextBase}"
                                           TextAlignment="Left"
                                           Margin="0,0,0,5"
                                           Text="Вход" />

                                <StackPanel Orientation="Horizontal"
                                            DataContext="{Binding ProductionBlockWorkspace}">

                                    <ItemsControl ItemsSource="{Binding RequestButtons}"
                                                  ItemTemplate="{StaticResource RequestButtonTemplate}">

                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel MaxWidth="310" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>

                                    <StackPanel Margin="5,0,0,0"
                                                Width="50"
                                                VerticalAlignment="Top"
                                                Background="LightSalmon"
                                                Visibility="{Binding Path=IsSomewhereOverclocked, Converter={StaticResource BVConverter}}">

                                        <Image Margin="5"
                                               ToolTip="Энергоячейка"
                                               Source="../Assets/Resources/SyntheticPowerShard.png"
                                               RenderOptions.BitmapScalingMode="HighQuality" />

                                        <TextBlock Background="Chocolate"
                                                   Foreground="GhostWhite"
                                                   TextAlignment="Center"
                                                   Text="{Binding PowerShardCountView}" />
                                    </StackPanel>

                                    <StackPanel Margin="5,0,0,0"
                                                Width="50"
                                                VerticalAlignment="Top"
                                                Background="MediumPurple"
                                                Visibility="{Binding Path=IsSomewhereSomersloopUsed, Converter={StaticResource BVConverter}}">

                                        <Image Margin="5"
                                               ToolTip="Петлевик"
                                               Source="../Assets/Resources/Somersloop.png"
                                               RenderOptions.BitmapScalingMode="HighQuality" />

                                        <TextBlock Background="Purple"
                                                   Foreground="GhostWhite"
                                                   TextAlignment="Center"
                                                   Text="{Binding SomersloopCountView}" />
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>

                            <ScrollViewer Grid.Row="1"
                                          Grid.Column="0"
                                          Grid.ColumnSpan="3"
                                          Margin="0,20,0,10"
                                          VerticalScrollBarVisibility="Auto"
                                          DataContext="{Binding ProductionBlockWorkspace}">

                                <ItemsControl ItemsSource="{Binding UnitModels}"
                                              ItemTemplate="{StaticResource ProductionUnitPanel}" />
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </DockPanel>
            </Border>
        </DockPanel>
    </Border>
</Window>
